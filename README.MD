![.NET CI](https://github.com/Luiz-Filipee/DesafioTesteLar/actions/workflows/dotnet.yml/badge.svg)

# üß© LarSolution

Projeto desenvolvido em **.NET 8** com arquitetura em camadas, utilizando **Entity Framework Core**, **AutoMapper**, **FluentValidation**, **JWT Authentication**, **Middleware**, **Docker**, **Swagger**, **Serilog** e **CI/CD com GitHub Actions**.  
O sistema realiza o gerenciamento de **usu√°rios, pessoas e telefones**, seguindo princ√≠pios de **SOLID** e **Clean Code**.

üí° O arquivo .env, configura√ß√µes do docker e outros documentos que n√£o precisam necessariamente estar presente no reposit√≥rio, tenho total ci√™ncia do uso do .gitigonore, por√©m todos cont√©m valores de exemplo apenas para facilitar a execu√ß√£o do teste t√©cnico.

---

## Tecnologias utilizadas

- **.NET 8**
- **ASP.NET Core Web API**
- **Entity Framework Core** (PostgreSQL, InMemory e SQLite)
- **AutoMapper**
- **FluentValidation**
- **JWT Authentication**
- **Middleware personalizado**
- **Docker / Docker Compose**
- **Swagger (Swashbuckle)**
- **Serilog** (logging)
- **BCrypt.Net** (hash de senhas)
- **xUnit**, **Moq**, **FluentAssertions** (testes unit√°rios e de integra√ß√£o)
- **GitHub Actions (CI/CD)**

---

## Estrutura do projeto

O projeto est√° dividido em quatro camadas principais:

LarSolution/ <br>
‚îÇ <br>
‚îú‚îÄ Lar.API -> Camada de apresenta√ß√£o (Controllers, autentica√ß√£o JWT) <br>
‚îú‚îÄ Lar.Application -> L√≥gica de neg√≥cio (Services, DTOs, Validators, AutoMapper) <br>
‚îú‚îÄ Lar.Domain -> Entidades e interfaces de reposit√≥rios <br>
‚îú‚îÄ Lar.Infrastructure -> Implementa√ß√£o de reposit√≥rios, DbContext e acesso ao banco <br>
‚îú‚îÄ Lar.Tests -> Testes unit√°rios e de controllers <br>


**Padr√µes aplicados:**
- Repository Pattern  
- Dependency Injection  
- DTOs e Mappers  
- Validation Layer  
- Middleware de erro global  
- Logging estruturado (Serilog)

---

## Funcionalidades implementadas

### 1. **Usu√°rios**
- CRUD de usu√°rios
- Autentica√ß√£o via JWT
- Senhas armazenadas com hash usando **BCrypt**
- Valida√ß√µes com **FluentValidation**:
  - `Username` obrigat√≥rio e m√≠nimo de 3 caracteres
  - `Password` obrigat√≥rio e m√≠nimo de 3 caracteres
  - `PessoaId` obrigat√≥rio
- Logging de opera√ß√µes (cria√ß√£o, atualiza√ß√£o, exclus√£o)

### 2. **Pessoas**
- CRUD de pessoas
- Relacionamento com telefones (uma pessoa pode ter v√°rios telefones)
- Valida√ß√µes:
  - `Nome` obrigat√≥rio
  - `Email` obrigat√≥rio e v√°lido
- Logging de opera√ß√µes

### 3. **Telefones**
- CRUD de telefones
- Consulta de telefones por pessoa
- Logging de opera√ß√µes

### 4. **Autentica√ß√£o**
- Login via endpoint `api/auth/login`
- Gera√ß√£o de token JWT com claims:
  - `sub` ‚Üí username
  - `jti` ‚Üí GUID √∫nico
- Valida√ß√£o de token em endpoints protegidos (`[Authorize]`)

---

## Banco de dados

- Utilizado **PostgreSQL** como principal
- Configura√ß√£o no `appsettings.json`:

### Docker
- A imagem da API √© constru√≠da via Dockerfile
- O docker-compose.yml configura a API e o banco PostgreSQL

**Subir todo o ambiente**
`docker-compose up --build`

---

## Logging

- Implementado com Serilog
- Logs para cria√ß√£o, atualiza√ß√£o, exclus√£o e erros
- Sa√≠da no console e integra√ß√£o com providers externos (extens√≠vel)
- Middleware global captura exce√ß√µes e retorna resposta padronizada

---

## Testes

- Testes unit√°rios com xUnit, Moq e FluentAssertions
- Cobertura para:
- Servi√ßos: UsuarioService, AuthService, PessoaService, TelefoneService
- Controllers: UsuariosController, PessoasController, TelefonesController, AuthController
- Valida√ß√µes simuladas usando mocks do FluentValidation

**Rodar os testes**
`dotnet test`

---

## Integra√ß√£o Cont√≠nua (CI/CD)
### O projeto possui pipeline automatizado via GitHub Actions, definido em .github/workflows/dotnet.yml.
### O fluxo executa automaticamente a cada push ou pull request:
- Restaura depend√™ncias (dotnet restore)
- Compila a solu√ß√£o (dotnet build)
- Executa todos os testes unit√°rios (dotnet test)
- Valida a integridade da aplica√ß√£o

---

# Como executar o projeto

## Clonar o reposit√≥rio:
`
git clone <URL_DO_REPOSITORIO>
cd LarSolution
`

## 1. Clonar o reposit√≥rio:
`
git clone <URL_DO_REPOSITORIO>
cd LarSolution
`

## 2. Restaurar pacotes:
`
dotnet restore
`

## 3. Criar banco e aplicar migrations:
`
cd Lar.Infrastructure 
dotnet ef database update
`

## 4. Executar a API:
`
cd Lar.API 
dotnet run
`

## Testar endpoints via Swagger:
Acesse https://localhost:5026/swagger

---

# Exemplos de chamadas de API

## Criar Pessoa
`
POST /api/pessoas  
Body:  
{  
  "nome": "Jo√£o Silva",  
  "email": "joao@email.com"  
}
`

## Login
`
POST /api/auth/login
Body: 
{ 
  "username": "joaos",
  "password": "123456"
} 
Response:
{ 
  "token": "<JWT_TOKEN>" 
}
`

## Criar Usu√°rio
`
POST /api/usuarios >
Body: 
{  
  "username": "joaos", 
  "password": "123456", 
  "pessoaId": 1  
}
`

## Consultar Telefones por Pessoa
`
GET /api/telefones/pessoa/1 
Headers:  
Authorization: Bearer <JWT_TOKEN>
`

---

# Observa√ß√µes
- Endpoints protegidos com [Authorize]
- Senhas nunca s√£o armazenadas em texto claro
- Logs monitoram opera√ß√µes cr√≠ticas
- Projeto estruturado para manuten√ß√£o e escalabilidade
- Estrutura projetada para facilidade de manuten√ß√£o e escalabilidade

---

Autor

Luiz Filipe
Desenvolvedor .NET | Clean Architecture | SOLID | Docker | Testes Automatizados
üîó GitHub

---

```json
"ConnectionStrings": {
  "PostgresConnection": "Host=localhost;Database=LarDb;Username=postgres;Password=senha"
}
